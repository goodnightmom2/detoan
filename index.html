<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Thử Toán 11 - Đề Số 6 (Có Lời Giải)</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #2980b9;
            --success: #27ae60;
            --danger: #c0392b;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f7;
            color: var(--dark);
            margin: 0;
            padding-bottom: 60px; /* Space for footer */
        }

        /* Sticky Timer */
        .timer-bar {
            position: fixed;
            top: 0;
            width: 100%;
            background-color: var(--dark);
            color: #fff;
            padding: 10px 0;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .timer-warning {
            background-color: var(--danger);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 900px;
            margin: 60px auto 20px auto; /* Margin top for sticky timer */
            background: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        h1 { text-align: center; color: var(--primary); }
        .part-header {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin-top: 30px;
            margin-bottom: 20px;
        }

        /* Question Styles */
        .question-card {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: 0.3s;
        }

        .q-text { font-weight: 600; margin-bottom: 15px; }

        /* Multiple Choice */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .option-label {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            cursor: pointer;
        }
        .option-label:hover { background: var(--light); }
        .option-label input { margin-right: 10px; }

        /* True/False Table */
        .tf-table { width: 100%; border-collapse: collapse; }
        .tf-table th, .tf-table td { border: 1px solid #ddd; padding: 8px; }
        .tf-table th { background: #f8f9fa; text-align: center; }
        .tf-center { text-align: center; width: 60px; }

        /* Short Answer */
        .short-input {
            width: 100%; max-width: 300px;
            padding: 8px; border: 2px solid #bdc3c7;
            border-radius: 4px; font-size: 16px;
        }

        /* EXPLANATION STYLES */
        .explanation {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding: 15px;
            background-color: #e8f6f3;
            border-left: 4px solid var(--success);
            font-size: 0.95em;
        }
        .explanation strong { color: var(--success); }

        /* Result Styles */
        .correct-card { border-color: var(--success); background-color: #f0fff4; }
        .wrong-card { border-color: var(--danger); background-color: #fff5f5; }
        
        .feedback-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .badge-correct { background: var(--success); color: white; }
        .badge-wrong { background: var(--danger); color: white; }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--dark);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 20px;
        }
        .submit-btn:hover { background: #34495e; }

        #result-area {
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            border: 2px solid var(--primary);
            border-radius: 8px;
            background: #eaf2f8;
        }
        .score-big { font-size: 2.5rem; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="timer-bar" id="timerDisplay">60:00</div>

<div class="container">
    <h1>ĐỀ KIỂM TRA TOÁN 11 - HK1</h1>
    <p style="text-align: center;">Mã đề: 006 | Thời gian: 60 phút</p>

    <form id="quizForm">
        
        <div class="part-header">PHẦN I. TRẮC NGHIỆM (3.0 điểm)</div>
        <div id="p1-container"></div>

        <div class="part-header">PHẦN II. ĐÚNG/SAI (4.0 điểm)</div>
        <div id="p2-container"></div>

        <div class="part-header">PHẦN III. TRẢ LỜI NGẮN (3.0 điểm)</div>
        <div id="p3-container"></div>

        <button type="button" class="submit-btn" onclick="submitExam()">NỘP BÀI</button>
    </form>

    <div id="result-area">
        <h3>KẾT QUẢ BÀI LÀM</h3>
        <div class="score-big"><span id="scoreVal">0</span>/10</div>
        <p>Kéo lên trên để xem lời giải chi tiết.</p>
    </div>
</div>

<script>
    // ================= DỮ LIỆU ĐỀ THI & LỜI GIẢI =================
    const examData = {
        p1: [
            {
                id: 1, 
                q: "Cho cấp số nhân \\( (u_n) \\) có \\( u_1 = 3 \\) và \\( u_2 = 12 \\). Công bội \\( q \\) bằng:", 
                opts: ["A. 4", "B. 9", "C. 3", "D. 1/4"], 
                correct: "A", 
                explain: "Ta có công thức \\( u_2 = u_1 \\cdot q \\). <br>Suy ra \\( 12 = 3 \\cdot q \\Rightarrow q = 4 \\)."
            },
            {
                id: 2, 
                q: "Số hạng tổng quát của cấp số nhân \\( 2; 4; 8; 16; ... \\) là:", 
                opts: ["A. \\( u_n = 2^n \\)", "B. \\( u_n = 2n \\)", "C. \\( u_n = 2^{n-1} \\)", "D. \\( u_n = n+2 \\)"], 
                correct: "A", 
                explain: "Dãy số có \\( u_1 = 2 \\) và công bội \\( q = 2 \\). <br>Công thức tổng quát: \\( u_n = u_1 \\cdot q^{n-1} = 2 \\cdot 2^{n-1} = 2^n \\)."
            },
            {
                id: 3, 
                q: "Kết quả của \\( \\lim \\left( 5 + \\frac{1}{n} \\right) \\) là:", 
                opts: ["A. 5", "B. 6", "C. 0", "D. \\( +\\infty \\)"], 
                correct: "A", 
                explain: "Vì \\( \\lim \\frac{1}{n} = 0 \\) nên \\( \\lim (5 + \\frac{1}{n}) = 5 + 0 = 5 \\)."
            },
            {
                id: 4, 
                q: "Tính giới hạn \\( L = \\lim_{x \\to 1} (x^2 - 4x + 1) \\).", 
                opts: ["A. -2", "B. 1", "C. -4", "D. 2"], 
                correct: "A", 
                explain: "Hàm đa thức liên tục trên R, thay \\( x=1 \\): <br>\\( L = 1^2 - 4(1) + 1 = 1 - 4 + 1 = -2 \\)."
            },
            {
                id: 5, 
                q: "Giới hạn \\( \\lim_{x \\to +\\infty} \\frac{3x^2 - x}{x^2 + 5} \\) bằng:", 
                opts: ["A. 3", "B. -1", "C. 0", "D. \\( +\\infty \\)"], 
                correct: "A", 
                explain: "Chia cả tử và mẫu cho \\( x^2 \\): <br>\\( \\lim \\frac{3 - 1/x}{1 + 5/x^2} = \\frac{3-0}{1+0} = 3 \\)."
            },
            {
                id: 6, 
                q: "Tính \\( \\lim_{x \\to 3} \\frac{x^2 - 9}{x - 3} \\).", 
                opts: ["A. 6", "B. 0", "C. 3", "D. \\( \\infty \\)"], 
                correct: "A", 
                explain: "\\( \\lim_{x \\to 3} \\frac{(x-3)(x+3)}{x-3} = \\lim_{x \\to 3} (x+3) = 3+3 = 6 \\)."
            },
            {
                id: 7, 
                q: "Hàm số \\( y = \\frac{2x}{x+1} \\) liên tục trên khoảng nào?", 
                opts: ["A. \\( (-1; +\\infty) \\)", "B. \\( (-\\infty; 0) \\)", "C. R", "D. \\( (-3; 3) \\)"], 
                correct: "A", 
                explain: "Hàm số xác định khi \\( x \\ne -1 \\). Do đó hàm số liên tục trên các khoảng \\( (-\\infty; -1) \\) và \\( (-1; +\\infty) \\)."
            },
            {
                id: 8, 
                q: "Mẫu số liệu: [0;20) tần số 5, [20;40) tần số 12, [40;60) tần số 3. Nhóm chứa mốt là:", 
                opts: ["A. [20; 40)", "B. [0; 20)", "C. [40; 60)", "D. Không xác định"], 
                correct: "A", 
                explain: "Nhóm chứa mốt là nhóm có tần số lớn nhất. Tần số 12 là lớn nhất, ứng với nhóm [20; 40)."
            },
            {
                id: 9, 
                q: "Nếu đường thẳng \\( d \\) song song với mặt phẳng \\( (\\alpha) \\) thì:", 
                opts: ["A. Chúng không có điểm chung", "B. \\( d \\subset (\\alpha) \\)", "C. Cắt nhau", "D. Vô số điểm chung"], 
                correct: "A", 
                explain: "Theo định nghĩa: Đường thẳng và mặt phẳng song song là chúng không có điểm chung."
            },
            {
                id: 10, 
                q: "Tứ diện ABCD, I, J là trung điểm AB, AC. IJ song song với:", 
                opts: ["A. (BCD)", "B. (ABD)", "C. (ACD)", "D. (ABC)"], 
                correct: "A", 
                explain: "IJ là đường trung bình \\( \\Delta ABC \\) nên \\( IJ // BC \\). <br>Mà \\( BC \\subset (BCD) \\) nên \\( IJ // (BCD) \\)."
            },
            {
                id: 11, 
                q: "Qua 1 điểm ngoài mặt phẳng, vẽ được bao nhiêu mp song song với mp đó?", 
                opts: ["A. 1", "B. 2", "C. Vô số", "D. 0"], 
                correct: "A", 
                explain: "Tính chất duy nhất: Qua một điểm nằm ngoài mặt phẳng, có duy nhất một mặt phẳng song song với mặt phẳng đó."
            },
            {
                id: 12, 
                q: "Lăng trụ \\( ABC.A'B'C' \\). Khẳng định SAI:", 
                opts: ["A. \\( (ABB'A') // (ACC'A') \\)", "B. \\( (ABC) // (A'B'C') \\)", "C. \\( AA' // BB' \\)", "D. \\( AB // A'B' \\)"], 
                correct: "A", 
                explain: "Hai mặt bên \\( (ABB'A') \\) và \\( (ACC'A') \\) cắt nhau theo giao tuyến \\( AA' \\), không song song."
            }
        ],
        p2: [
            {
                id: 1,
                q: "Gửi 100 triệu, lãi suất 6%/năm (lãi kép). Gọi \\( u_n \\) là tiền sau n năm.",
                sub: [
                    { t: "Dãy số là cấp số nhân.", ans: true },
                    { t: "Công bội \\( q = 0.06 \\).", ans: false },
                    { t: "Sau 1 năm có 106 triệu.", ans: true },
                    { t: "Sau 10 năm có xấp xỉ 179 triệu.", ans: true }
                ],
                explain: "a) Đúng. Công thức lãi kép \\( A_n = A_0(1+r)^n \\) là CSN.<br>b) Sai. Công bội \\( q = 1 + r = 1 + 0.06 = 1.06 \\).<br>c) Đúng. \\( 100(1.06)^1 = 106 \\).<br>d) Đúng. \\( 100(1.06)^{10} \\approx 179.08 \\)."
            },
            {
                id: 2,
                q: "Hàm số \\( f(x) = \\frac{x^2-1}{x-1} \\) khi \\( x \\ne 1 \\), bằng 3 khi \\( x=1 \\).",
                sub: [
                    { t: "TXĐ là \\( R \\setminus \\{1\\} \\).", ans: false },
                    { t: "\\( \\lim_{x \\to 1} f(x) = 2 \\).", ans: true },
                    { t: "\\( f(1) = 3 \\).", ans: true },
                    { t: "Hàm số liên tục tại \\( x=1 \\).", ans: false }
                ],
                explain: "a) Sai. Đề bài cho \\( f(1)=3 \\) nên TXĐ là R.<br>b) Đúng. \\( \\lim (x+1) = 2 \\).<br>c) Đúng. Giả thiết.<br>d) Sai. Vì \\( \\lim f(x) = 2 \\ne f(1)=3 \\)."
            },
            {
                id: 3,
                q: "Hình chóp S.ABCD, đáy hbh tâm O.",
                sub: [
                    { t: "Giao tuyến (SAC) và (SBD) là SO.", ans: true },
                    { t: "AB // (SCD).", ans: true },
                    { t: "(SAB) // (SCD).", ans: false },
                    { t: "Mp qua O // (SAB) cắt SC tại trung điểm SC.", ans: true }
                ],
                explain: "c) Sai. Hai mặt phẳng này cắt nhau theo giao tuyến qua S song song AB, CD.<br>d) Đúng. Mp qua O song song (SAB) sẽ song song SB. Trong tam giác SBD, đường thẳng qua O // SB là đường trung bình, đi qua trung điểm SD (tương tự với AC sẽ qua trung điểm SC)."
            },
            {
                id: 4,
                q: "Hình hộp ABCD.A'B'C'D'.",
                sub: [
                    { t: "(ADD'A') // (BCC'B').", ans: true },
                    { t: "AC' cắt (A'B'C'D').", ans: true },
                    { t: "AB và C'D' chéo nhau.", ans: false },
                    { t: "(AB'D') // (BDC').", ans: true }
                ],
                explain: "c) Sai. \\( AB // CD // C'D' \\) nên chúng song song, không chéo nhau."
            }
        ],
        p3: [
            {
                id: 1,
                q: "Bóng rơi từ 10m, nảy \\( \\frac{2}{3} \\). Độ cao sau lần chạm đất thứ 3? (Làm tròn 1 số thập phân)",
                correct: 3.0,
                explain: "Độ cao sau lần 1: \\( 10 \\cdot \\frac{2}{3} \\).<br>Độ cao sau lần 2: \\( 10 \\cdot (\\frac{2}{3})^2 \\).<br>Độ cao sau lần 3: \\( h_3 = 10 \\cdot (\\frac{2}{3})^3 = 10 \\cdot \\frac{8}{27} \\approx 2.96 \\). Làm tròn 3.0m."
            },
            {
                id: 2,
                q: "Điểm TB nhóm: [0;5): 2 hs, [5;8): 10 hs, [8;10]: 8 hs. (Làm tròn 1 số thập phân)",
                correct: 7.1,
                explain: "Đại diện: \\( c_1=2.5, c_2=6.5, c_3=9 \\).<br>TB = \\( \\frac{2(2.5) + 10(6.5) + 8(9)}{20} = \\frac{5 + 65 + 72}{20} = \\frac{142}{20} = 7.1 \\)."
            },
            {
                id: 3,
                q: "Biết \\( \\lim_{x \\to 2} \\frac{x^2 + ax + b}{x - 2} = 6 \\). Tính \\( a+b \\).",
                correct: -6,
                explain: "Tử phải có nghiệm 2: \\( 4 + 2a + b = 0 \\Rightarrow b = -2a - 4 \\).<br>Giới hạn: \\( \\lim (x + a + 2) = 4 + a = 6 \\Rightarrow a = 2 \\).<br>Suy ra \\( b = -4 - 4 = -8 \\).<br>\\( a + b = 2 + (-8) = -6 \\)."
            },
            {
                id: 4,
                q: "Tìm m để \\( f(x) = \\frac{\\sqrt{x+1}-1}{x} \\) liên tục tại 0.",
                correct: 0.5,
                explain: "\\( \\lim_{x \\to 0} \\frac{x}{x(\\sqrt{x+1}+1)} = \\frac{1}{2} = 0.5 \\).<br>Để liên tục thì \\( m = 0.5 \\)."
            },
            {
                id: 5,
                q: "Người cao 1.6m bóng 0.8m. Cột cờ bóng 5m thì cao bao nhiêu?",
                correct: 10,
                explain: "Tỉ lệ: \\( \\frac{h_{nguoi}}{bong_{nguoi}} = \\frac{h_{cot}}{bong_{cot}} \\Rightarrow \\frac{1.6}{0.8} = \\frac{h}{5} \\).<br>\\( h = 2 \\cdot 5 = 10 \\)m."
            },
            {
                id: 6,
                q: "Tỉ số diện tích \\( \\frac{S_{DMN}}{S_{DBC}} \\) (Nhập phân số dạng a/b)",
                correct: "4/9",
                explain: "Mp qua trọng tâm G song song đáy sẽ cắt cạnh bên theo tỉ lệ \\( \\frac{DM}{DB} = \\frac{2}{3} \\).<br>Tỉ số diện tích đồng dạng: \\( k^2 = (\\frac{2}{3})^2 = \\frac{4}{9} \\)."
            }
        ]
    };

    // ================= RENDER CÂU HỎI =================
    
    // Render P1
    const p1Cont = document.getElementById('p1-container');
    examData.p1.forEach((item, index) => {
        let html = `
        <div class="question-card" id="p1_q${item.id}">
            <div class="q-text">Câu ${index+1}: ${item.q}</div>
            <div class="options-grid">
                ${item.opts.map(opt => `
                    <label class="option-label">
                        <input type="radio" name="p1_q${item.id}" value="${opt.split('.')[0]}"> ${opt}
                    </label>
                `).join('')}
            </div>
            <div class="explanation" id="exp_p1_q${item.id}">
                <strong>Lời giải:</strong> ${item.explain}
            </div>
        </div>`;
        p1Cont.innerHTML += html;
    });

    // Render P2
    const p2Cont = document.getElementById('p2-container');
    examData.p2.forEach((item, index) => {
        let rows = item.sub.map((s, i) => `
            <tr>
                <td class="tf-center">${String.fromCharCode(97+i)}</td>
                <td>${s.t}</td>
                <td class="tf-center"><input type="radio" name="p2_q${item.id}_${i}" value="true"></td>
                <td class="tf-center"><input type="radio" name="p2_q${item.id}_${i}" value="false"></td>
            </tr>
        `).join('');

        let html = `
        <div class="question-card" id="p2_q${item.id}">
            <div class="q-text">Câu ${index+1}: ${item.q}</div>
            <table class="tf-table">
                <tr><th>Ý</th><th>Nội dung</th><th>Đúng</th><th>Sai</th></tr>
                ${rows}
            </table>
            <div class="explanation" id="exp_p2_q${item.id}">
                <strong>Giải thích:</strong> ${item.explain}
            </div>
        </div>`;
        p2Cont.innerHTML += html;
    });

    // Render P3
    const p3Cont = document.getElementById('p3-container');
    examData.p3.forEach((item, index) => {
        let html = `
        <div class="question-card" id="p3_q${item.id}">
            <div class="q-text">Câu ${index+1}: ${item.q}</div>
            <input type="text" class="short-input" id="inp_p3_q${item.id}" placeholder="Nhập kết quả...">
            <div class="explanation" id="exp_p3_q${item.id}">
                <strong>Đáp án:</strong> ${item.correct}. <br>
                <strong>Lời giải:</strong> ${item.explain}
            </div>
        </div>`;
        p3Cont.innerHTML += html;
    });

    // ================= LOGIC ĐỒNG HỒ =================
    let timeLeft = 60 * 60; // 60 minutes
    const timerEl = document.getElementById('timerDisplay');
    
    const timerInterval = setInterval(() => {
        timeLeft--;
        let m = Math.floor(timeLeft / 60);
        let s = timeLeft % 60;
        timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        
        if (timeLeft <= 300) { // Last 5 mins
            timerEl.classList.add('timer-warning');
        }

        if (timeLeft <= 0) {
            clearInterval(timerInterval);
            submitExam();
            alert("Hết giờ làm bài!");
        }
    }, 1000);

    // ================= LOGIC CHẤM ĐIỂM =================
    function submitExam() {
        clearInterval(timerInterval);
        let score = 0;

        // Chấm P1
        examData.p1.forEach(item => {
            const els = document.getElementsByName(`p1_q${item.id}`);
            let userVal = '';
            for(let el of els) if(el.checked) userVal = el.value;
            
            const card = document.getElementById(`p1_q${item.id}`);
            const exp = document.getElementById(`exp_p1_q${item.id}`);
            exp.style.display = 'block';

            if(userVal === item.correct) {
                score += 0.25;
                card.classList.add('correct-card');
                card.insertAdjacentHTML('beforeend', '<div class="feedback-badge badge-correct">Đúng (+0.25đ)</div>');
            } else {
                card.classList.add('wrong-card');
                card.insertAdjacentHTML('beforeend', `<div class="feedback-badge badge-wrong">Sai. Đáp án đúng: ${item.correct}</div>`);
            }
        });

        // Chấm P2
        examData.p2.forEach(item => {
            let correctCount = 0;
            item.sub.forEach((s, i) => {
                const els = document.getElementsByName(`p2_q${item.id}_${i}`);
                let userVal = null;
                for(let el of els) if(el.checked) userVal = (el.value === 'true');
                
                // Highlight row
                if(userVal === s.ans) correctCount++;
            });

            const card = document.getElementById(`p2_q${item.id}`);
            const exp = document.getElementById(`exp_p2_q${item.id}`);
            exp.style.display = 'block';

            let points = 0;
            if(correctCount === 1) points = 0.1;
            else if(correctCount === 2) points = 0.25;
            else if(correctCount === 3) points = 0.5;
            else if(correctCount === 4) points = 1.0;

            score += points;
            
            if(correctCount === 4) {
                card.classList.add('correct-card');
                card.insertAdjacentHTML('beforeend', `<div class="feedback-badge badge-correct">Đúng 4/4 ý (+1.0đ)</div>`);
            } else {
                card.classList.add('wrong-card');
                card.insertAdjacentHTML('beforeend', `<div class="feedback-badge badge-wrong">Đúng ${correctCount}/4 ý (+${points}đ)</div>`);
            }
        });

        // Chấm P3
        examData.p3.forEach(item => {
            const inp = document.getElementById(`inp_p3_q${item.id}`);
            const userVal = inp.value.trim();
            const card = document.getElementById(`p3_q${item.id}`);
            const exp = document.getElementById(`exp_p3_q${item.id}`);
            exp.style.display = 'block';

            let isCorrect = false;
            // Xử lý số học (sai số 0.1) hoặc so sánh chuỗi
            if (typeof item.correct === 'number') {
                if (Math.abs(parseFloat(userVal) - item.correct) < 0.1) isCorrect = true;
            } else {
                if (userVal === item.correct) isCorrect = true;
            }

            if(isCorrect) {
                score += 0.5;
                card.classList.add('correct-card');
                card.insertAdjacentHTML('beforeend', '<div class="feedback-badge badge-correct">Đúng (+0.5đ)</div>');
            } else {
                card.classList.add('wrong-card');
                card.insertAdjacentHTML('beforeend', `<div class="feedback-badge badge-wrong">Sai</div>`);
            }
        });

        // Hiển thị kết quả
        const resultArea = document.getElementById('result-area');
        document.getElementById('scoreVal').textContent = score.toFixed(2);
        resultArea.style.display = 'block';
        
        // Scroll xuống dưới
        resultArea.scrollIntoView({behavior: "smooth"});
        
        // Disable nút nộp
        document.querySelector('.submit-btn').disabled = true;
        document.querySelector('.submit-btn').innerText = "ĐÃ CHẤM BÀI";
    }
</script>

</body>
</html>
